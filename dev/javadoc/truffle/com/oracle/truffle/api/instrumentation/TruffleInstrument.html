<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (26) -->
<title>TruffleInstrument (GraalVM Truffle Java API Reference)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.oracle.truffle.api.instrumentation, class: TruffleInstrument">
<meta name="generator" content="javadoc/ClassWriter">
<link rel="stylesheet" type="text/css" href="../../../../../resource-files/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="../../../../../resource-files/stylesheet.css">
<script type="text/javascript" src="../../../../../script-files/script.js"></script>
<script type="text/javascript" src="../../../../../script-files/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-files/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">const pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="nav-content">
<div class="nav-menu-button"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button></div>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../search.html">Search</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
<div class="about-language"><b>GraalVM Truffle Java API Reference<br>26.0.0-dev</b><br>2cb5f709a02689d9a069a2e61c66c7ffbeee92a1</div>
</div>
</div>
<div class="sub-nav">
<div class="nav-content">
<ol class="sub-nav-list">
<li><a href="package-summary.html">com.oracle.truffle.api.instrumentation</a></li>
<li><a href="TruffleInstrument.html" class="current-selection">TruffleInstrument</a></li>
</ol>
<div class="nav-list-search"><input type="text" id="search-input" disabled placeholder="Search documentation (type /)" aria-label="Search in documentation" autocomplete="off" spellcheck="false"><input type="reset" id="reset-search" disabled value="Reset"></div>
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="main-grid">
<nav role="navigation" class="toc" aria-label="Table of contents">
<div class="toc-header">Contents&nbsp;<input type="text" class="filter-input" disabled placeholder="Filter contents (type .)" aria-label="Filter table of contents" autocomplete="off" spellcheck="false"><input type="reset" class="reset-filter" disabled tabindex="-1" value="Reset"></div>
<ol class="toc-list" tabindex="-1">
<li><a href="#" tabindex="0">Description</a></li>
<li><a href="#nested-class-summary" tabindex="0">Nested Class Summary</a></li>
<li><a href="#field-summary" tabindex="0">Field Summary</a></li>
<li><a href="#constructor-summary" tabindex="0">Constructor Summary</a></li>
<li><a href="#method-summary" tabindex="0">Method Summary</a></li>
<li><a href="#field-detail" tabindex="0">Field Details</a>
<ol class="toc-list">
<li><a href="#locals" tabindex="0">locals</a></li>
</ol>
</li>
<li><a href="#constructor-detail" tabindex="0">Constructor Details</a>
<ol class="toc-list">
<li><a href="#%3Cinit%3E()" tabindex="0">TruffleInstrument()</a></li>
</ol>
</li>
<li><a href="#method-detail" tabindex="0">Method Details</a>
<ol class="toc-list">
<li><a href="#onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)" tabindex="0">onCreate(TruffleInstrument.Env)</a></li>
<li><a href="#onFinalize(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)" tabindex="0">onFinalize(TruffleInstrument.Env)</a></li>
<li><a href="#onDispose(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)" tabindex="0">onDispose(TruffleInstrument.Env)</a></li>
<li><a href="#getOptionDescriptors()" tabindex="0">getOptionDescriptors()</a></li>
<li><a href="#getContextOptionDescriptors()" tabindex="0">getContextOptionDescriptors()</a></li>
<li><a href="#getSourceOptionDescriptors()" tabindex="0">getSourceOptionDescriptors()</a></li>
<li><a href="#createContextLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextLocalFactory)" tabindex="0">createContextLocal(TruffleInstrument.ContextLocalFactory)</a></li>
<li><a href="#createContextThreadLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextThreadLocalFactory)" tabindex="0">createContextThreadLocal(TruffleInstrument.ContextThreadLocalFactory)</a></li>
</ol>
</li>
</ol>
<button class="hide-sidebar"><span>Hide sidebar&nbsp;</span><img src="../../../../../resource-files/left.svg" alt="Hide sidebar"></button><button class="show-sidebar"><img src="../../../../../resource-files/right.svg" alt="Show sidebar"><span>&nbsp;Show sidebar</span></button></nav>
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<h1 title="Class TruffleInstrument" class="title">Class TruffleInstrument</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">com.oracle.truffle.api.instrumentation.TruffleInstrument</div>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="horizontal-scroll">
<div class="type-signature"><span class="modifiers">public abstract class </span><span class="element-name type-name-label">TruffleInstrument</span>
<span class="extends-implements">extends <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></span></div>
<div class="block">The service provider interface (SPI) for Truffle instruments: clients of Truffle instrumentation
that may observe and inject behavior into interpreters written using the Truffle framework.
<p>
Instrument implementation classes must use the <a href="TruffleInstrument.Registration.html" title="annotation interface in com.oracle.truffle.api.instrumentation"><code>TruffleInstrument.Registration</code></a> annotation to provide
required metadata and to enable automatic discovery of the implementation.
<p>
An instrument is <a href="#onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)"><code>created </code></a> if at least one instrument
<a href="TruffleInstrument.Env.html#getOptions()"><code>option</code></a> was specified or if a
<a href="TruffleInstrument.Env.html#registerService(java.lang.Object)"><code>service</code></a> was looked up. The
<a href="Instrumenter.html" title="class in com.oracle.truffle.api.instrumentation"><code>Instrumenter</code></a> available in the provided <a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">environment</a> allows the instrument
instance to bind listeners for <a href="ExecutionEventListener.html" title="interface in com.oracle.truffle.api.instrumentation">execution</a> and
<a href="LoadSourceListener.html" title="interface in com.oracle.truffle.api.instrumentation">source</a> events, as well as <a href="ExecutionEventNodeFactory.html" title="interface in com.oracle.truffle.api.instrumentation">node factories</a> for code injection at guest language code locations.
<p>
An instrument is disposed when the associated polyglot <a href="../../../../../org/graalvm/polyglot/Engine.html" title="class in org.graalvm.polyglot">engine</a> is disposed.
All active bindings created by a disposed instrument become disposed automatically. The
<a href="Instrumenter.html" title="class in com.oracle.truffle.api.instrumentation"><code>Instrumenter</code></a> instance available in the provided <a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">environment</a> may not be
used after disposal.
<p>
<h4 id="example-for-a-simple-expression-coverage-instrument--heading">Example for a simple expression coverage instrument:</h4>

<div class="snippet-container"><button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../../resource-files/copy.svg" alt="Copy snippet"></button>
<pre class="snippet" id="snippet-com.oracle.truffle.api.instrumentation.TruffleInstrument1"><code class="language-java">@Registration(id = CoverageExample.ID, services = Object.class)
public final class CoverageExample extends TruffleInstrument {

    public static final String ID = "test-coverage";

    private final Set&lt;SourceSection&gt; coverage = new HashSet&lt;&gt;();

    @Override
    protected void onCreate(final Env env) {
        SourceSectionFilter.Builder builder = SourceSectionFilter.newBuilder();
        SourceSectionFilter filter = builder.tagIs(ExpressionTag.class).build();
        Instrumenter instrumenter = env.getInstrumenter();
        instrumenter.attachExecutionEventFactory(filter,
                        new CoverageExampleEventFactory(env));
    }

    private class CoverageExampleEventFactory
                    implements ExecutionEventNodeFactory {

        private final Env env;

        CoverageExampleEventFactory(final Env env) {
            this.env = env;
        }

        public ExecutionEventNode create(final EventContext ec) {
            final PrintStream out = new PrintStream(env.out());
            return new ExecutionEventNode() {
                @CompilationFinal private boolean visited;

                @Override
                public void onReturnValue(VirtualFrame vFrame, Object result) {
                    if (!visited) {
                        CompilerDirectives.transferToInterpreterAndInvalidate();
                        visited = true;
                        SourceSection src = ec.getInstrumentedSourceSection();
                        out.print(src.getCharIndex() + " ");
                        coverage.add(src);
                    }
                }
            };
        }
    }

}
</code></pre>
</div>
</div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.12</dd>
</dl>
</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>protected static interface&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="TruffleInstrument.ContextLocalFactory.html" class="type-name-link" title="interface in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextLocalFactory</a>&lt;<a href="TruffleInstrument.ContextLocalFactory.html#type-param-T" title="type parameter in TruffleInstrument.ContextLocalFactory">T</a>&gt;</code></div>
<div class="col-last even-row-color">
<div class="block">Context local factory for Truffle instruments.</div>
</div>
<div class="col-first odd-row-color"><code>protected static final class&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="TruffleInstrument.ContextLocalProvider.html" class="type-name-link" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextLocalProvider</a></code></div>
<div class="col-last odd-row-color">
<div class="block">Provider for creating context local and context thread local references.</div>
</div>
<div class="col-first even-row-color"><code>protected static interface&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="TruffleInstrument.ContextThreadLocalFactory.html" class="type-name-link" title="interface in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextThreadLocalFactory</a>&lt;<a href="TruffleInstrument.ContextThreadLocalFactory.html#type-param-T" title="type parameter in TruffleInstrument.ContextThreadLocalFactory">T</a>&gt;</code></div>
<div class="col-last even-row-color">
<div class="block">Context local factory for Truffle instruments.</div>
</div>
<div class="col-first odd-row-color"><code>static final class&nbsp;</code></div>
<div class="col-second odd-row-color"><code><a href="TruffleInstrument.Env.html" class="type-name-link" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.Env</a></code></div>
<div class="col-last odd-row-color">
<div class="block">Access to instrumentation services as well as input, output, and error streams.</div>
</div>
<div class="col-first even-row-color"><code>static @interface&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="TruffleInstrument.Registration.html" class="type-name-link" title="annotation interface in com.oracle.truffle.api.instrumentation">TruffleInstrument.Registration</a></code></div>
<div class="col-last even-row-color">
<div class="block">Annotation that registers an <a href="TruffleInstrument.html" title="class in com.oracle.truffle.api.instrumentation"><code>instrument</code></a> implementations for
automatic discovery.</div>
</div>
</div>
</section>
</li>
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="caption"><span>Fields</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Field</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>protected final <a href="TruffleInstrument.ContextLocalProvider.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextLocalProvider</a></code></div>
<div class="col-second even-row-color"><code><a href="#locals" class="member-name-link">locals</a></code></div>
<div class="col-last even-row-color">
<div class="block">Provider for creating context local and context thread local references.</div>
</div>
</div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier</div>
<div class="table-header col-second">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>protected </code></div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E()" class="member-name-link">TruffleInstrument</a>()</code></div>
<div class="col-last even-row-color">
<div class="block">Constructor for subclasses.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab3" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab3', 3)" class="table-tab">Abstract Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button><button id="method-summary-table-tab6" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab6', 3)" class="table-tab">Deprecated Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel" aria-labelledby="method-summary-table-tab0">
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>protected final &lt;T&gt;&nbsp;<a href="../ContextLocal.html" title="class in com.oracle.truffle.api">ContextLocal</a><wbr>&lt;T&gt;</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#createContextLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextLocalFactory)" class="member-name-link">createContextLocal</a><wbr>(<a href="TruffleInstrument.ContextLocalFactory.html" title="interface in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextLocalFactory</a>&lt;T&gt;&nbsp;factory)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span>
<div class="deprecation-comment">in 23.1, use
            <a href="TruffleInstrument.ContextLocalProvider.html#createContextLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextLocal(TruffleInstrument.ContextLocalFactory)</code></a>
            instead</div>
</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code>protected final &lt;T&gt;&nbsp;<a href="../ContextThreadLocal.html" title="class in com.oracle.truffle.api">ContextThreadLocal</a><wbr>&lt;T&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6"><code><a href="#createContextThreadLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextThreadLocalFactory)" class="member-name-link">createContextThreadLocal</a><wbr>(<a href="TruffleInstrument.ContextThreadLocalFactory.html" title="interface in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextThreadLocalFactory</a>&lt;T&gt;&nbsp;factory)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4 method-summary-table-tab6">
<div class="block"><span class="deprecated-label">Deprecated.</span>
<div class="deprecation-comment">in 23.1, use
            <a href="TruffleInstrument.ContextLocalProvider.html#createContextThreadLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextThreadLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextThreadLocal(TruffleInstrument.ContextThreadLocalFactory)</code></a>
            instead</div>
</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../../../../../org/graalvm/options/OptionDescriptors.html" title="interface in org.graalvm.options">OptionDescriptors</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getContextOptionDescriptors()" class="member-name-link">getContextOptionDescriptors</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns a set of option descriptors for instrument options that can be specified per context.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../../../../../org/graalvm/options/OptionDescriptors.html" title="interface in org.graalvm.options">OptionDescriptors</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getOptionDescriptors()" class="member-name-link">getOptionDescriptors</a>()</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns a set of option descriptors that are supported by this instrument.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected <a href="../../../../../org/graalvm/options/OptionDescriptors.html" title="interface in org.graalvm.options">OptionDescriptors</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#getSourceOptionDescriptors()" class="member-name-link">getSourceOptionDescriptors</a>()</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Returns a set of source option descriptors that are supported by this language.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code>protected abstract void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3"><code><a href="#onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)" class="member-name-link">onCreate</a><wbr>(<a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.Env</a>&nbsp;env)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab3">
<div class="block">Invoked once on each newly allocated <a href="TruffleInstrument.html" title="class in com.oracle.truffle.api.instrumentation"><code>TruffleInstrument</code></a> instance.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#onDispose(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)" class="member-name-link">onDispose</a><wbr>(<a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.Env</a>&nbsp;env)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Invoked once on an <a href="TruffleInstrument.html" title="class in com.oracle.truffle.api.instrumentation">instance</a> when it becomes disabled, possibly
because the underlying <a href="../../../../../org/graalvm/polyglot/Engine.html" title="class in org.graalvm.polyglot">engine</a> has been closed.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>protected void</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#onFinalize(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)" class="member-name-link">onFinalize</a><wbr>(<a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.Env</a>&nbsp;env)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Invoked once on an <a href="TruffleInstrument.html" title="class in com.oracle.truffle.api.instrumentation">instance</a> just before all instruments and
languages are going to be disposed, possibly because the underlying
<a href="../../../../../org/graalvm/polyglot/Engine.html" title="class in org.graalvm.polyglot">engine</a> is going to be closed.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;<a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#method-summary" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ============ FIELD DETAIL =========== -->
<li>
<section class="field-details" id="field-detail">
<h2>Field Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="locals">
<h3>locals</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected final</span>&nbsp;<span class="return-type"><a href="TruffleInstrument.ContextLocalProvider.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextLocalProvider</a></span>&nbsp;<span class="element-name">locals</span></div>
<div class="block">Provider for creating context local and context thread local references.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>23.1</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="TruffleInstrument.ContextLocalProvider.html#createContextLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextLocal(TruffleInstrument.ContextLocalFactory)</code></a></li>
<li><a href="TruffleInstrument.ContextLocalProvider.html#createContextThreadLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextThreadLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextThreadLocal(TruffleInstrument.ContextThreadLocalFactory)</code></a></li>
</ul>
</dd>
</dl>
</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;()">
<h3>TruffleInstrument</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="element-name">TruffleInstrument</span>()</div>
<div class="block">Constructor for subclasses.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.12</dd>
</dl>
</div>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)">
<h3>onCreate</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected abstract</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">onCreate</span><wbr><span class="parameters">(<a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.Env</a>&nbsp;env)</span></div>
<div class="block">Invoked once on each newly allocated <a href="TruffleInstrument.html" title="class in com.oracle.truffle.api.instrumentation"><code>TruffleInstrument</code></a> instance.
<p>
The method may <a href="TruffleInstrument.Env.html#registerService(java.lang.Object)"><code>register</code></a> additional
<a href="TruffleInstrument.Registration.html#services()"><code>services</code></a> - e.g. objects to be exposed via
<a href="../../../../../org/graalvm/polyglot/Instrument.html#lookup(java.lang.Class)"><code>lookup query</code></a>. For example to expose a debugger
one could define an abstract debugger controller:
</p>

<div class="snippet-container"><button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../../resource-files/copy.svg" alt="Copy snippet"></button>
<pre class="snippet" id="snippet-onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)1"><code class="language-java">public abstract class DebuggerController {
    DebuggerController() {
    }

    public abstract void installBreakpoint(int i, Callback callback);

    public abstract void stepInto(Callback callback);

    public abstract void stepOut(Callback callback);

    public abstract void stepOver(Callback callback);

    public interface Callback {

        void halted(DebuggerController debugger, EventContext haltedAt);

    }

}
</code></pre>
</div>


and declare it as a <a href="TruffleInstrument.Registration.html#services()"><code>service</code></a> associated with the instrument,
implement it, instantiate and <a href="TruffleInstrument.Env.html#registerService(java.lang.Object)"><code>register</code></a> in own's
instrument <a href="#onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)"><code>onCreate</code></a> method:

<div class="snippet-container"><button class="copy snippet-copy" aria-label="Copy snippet" onclick="copySnippet(this)"><span data-copied="Copied!">Copy</span><img src="../../../../../resource-files/copy.svg" alt="Copy snippet"></button>
<pre class="snippet" id="snippet-onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)2"><code class="language-java">@Registration(id = DebuggerExample.ID, services = DebuggerController.class)
public final class DebuggerExample extends TruffleInstrument {
    private Controller controller;

    @Override
    protected void onCreate(Env env) {
        assert this.controller == null;
        this.controller = new Controller(env.getInstrumenter());
        env.registerService(controller);
    }

    private static final class Controller extends DebuggerController {
        private final Instrumenter instrumenter;
        private EventBinding&lt;?&gt; stepping;
        private Callback currentStatementCallback;

        Controller(Instrumenter instrumenter) {
            this.instrumenter = instrumenter;
        }

</code></pre>
</div>

<p>
If this method throws an <a href="../exception/AbstractTruffleException.html" title="class in com.oracle.truffle.api.exception"><code>AbstractTruffleException</code></a>
the exception interop messages are executed without a context being entered.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>env</code> - environment information for the instrument</dd>
<dt>Since:</dt>
<dd>0.12</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="TruffleInstrument.Env.html#getInstrumenter()"><code>TruffleInstrument.Env.getInstrumenter()</code></a></li>
</ul>
</dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="onFinalize(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)">
<h3>onFinalize</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">onFinalize</span><wbr><span class="parameters">(<a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.Env</a>&nbsp;env)</span></div>
<div class="block">Invoked once on an <a href="TruffleInstrument.html" title="class in com.oracle.truffle.api.instrumentation">instance</a> just before all instruments and
languages are going to be disposed, possibly because the underlying
<a href="../../../../../org/graalvm/polyglot/Engine.html" title="class in org.graalvm.polyglot">engine</a> is going to be closed. This method is called
before <a href="#onDispose(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)"><code>onDispose(Env)</code></a> and the instrument must remain usable after finalization. The
instrument can prepare for disposal while still having other instruments not disposed yet. In
the event of VM shutdown, <a href="#onDispose(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)"><code>onDispose(Env)</code></a> for active instruments on unclosed
<a href="../../../../../org/graalvm/polyglot/Engine.html" title="class in org.graalvm.polyglot"><code>engines</code></a> is not called, and so in case the instrument is
supposed to do some specific action before its disposal, e.g. print some kind of summary, it
should be done in this method.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>env</code> - environment information for the instrument</dd>
<dt>Since:</dt>
<dd>19.0</dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="onDispose(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)">
<h3>onDispose</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type">void</span>&nbsp;<span class="element-name">onDispose</span><wbr><span class="parameters">(<a href="TruffleInstrument.Env.html" title="class in com.oracle.truffle.api.instrumentation">TruffleInstrument.Env</a>&nbsp;env)</span></div>
<div class="block">Invoked once on an <a href="TruffleInstrument.html" title="class in com.oracle.truffle.api.instrumentation">instance</a> when it becomes disabled, possibly
because the underlying <a href="../../../../../org/graalvm/polyglot/Engine.html" title="class in org.graalvm.polyglot">engine</a> has been closed. A
disposed instance is no longer usable. If the instrument is re-enabled, the engine will
create a new instance. In the event of VM shutdown, this method is not called for active
instruments on unclosed <a href="../../../../../org/graalvm/polyglot/Engine.html" title="class in org.graalvm.polyglot"><code>engines</code></a>. The unclosed engines are
not closed automatically on VM shutdown, they just die with the VM.</div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>env</code> - environment information for the instrument</dd>
<dt>Since:</dt>
<dd>0.12</dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="getOptionDescriptors()">
<h3>getOptionDescriptors</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../../../org/graalvm/options/OptionDescriptors.html" title="interface in org.graalvm.options">OptionDescriptors</a></span>&nbsp;<span class="element-name">getOptionDescriptors</span>()</div>
<div class="block">Returns a set of option descriptors that are supported by this instrument. Option values are
accessible using the <a href="TruffleInstrument.Env.html#getOptions()"><code>environment</code></a> when the instrument is
<a href="#onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)"><code>created</code></a>. By default no options are available for an instrument.
Options returned by this method must specify the <a href="TruffleInstrument.Registration.html#id()"><code>instrument id</code></a> as
<a href="../../../../../org/graalvm/options/OptionDescriptor.html#getName()"><code>name</code></a> prefix for each option. For example if the id of the
instrument is "debugger" then a valid option name would be "debugger.Enabled". The instrument
will automatically be <a href="#onCreate(com.oracle.truffle.api.instrumentation.TruffleInstrument.Env)"><code>created</code></a> if one of the specified options was
provided by the engine. To construct option descriptors from a list then
<a href="../../../../../org/graalvm/options/OptionDescriptors.html#create(java.util.List)"><code>OptionDescriptors.create(List)</code></a> can be used.
<p>
By default option descriptors may only be specified per engine or bound engine, but option
values may also be specified per context. In this case the context specific options can be
specified with <a href="#getContextOptionDescriptors()"><code>getContextOptionDescriptors()</code></a> and the values can be accessed with
<a href="TruffleInstrument.Env.html#getOptions(com.oracle.truffle.api.TruffleContext)"><code>TruffleInstrument.Env.getOptions(TruffleContext)</code></a>.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.27</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="../Option.html" title="annotation interface in com.oracle.truffle.api">For an example of declaring the option descriptor using an annotation.</a></li>
</ul>
</dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="getContextOptionDescriptors()">
<h3>getContextOptionDescriptors</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../../../org/graalvm/options/OptionDescriptors.html" title="interface in org.graalvm.options">OptionDescriptors</a></span>&nbsp;<span class="element-name">getContextOptionDescriptors</span>()</div>
<div class="block">Returns a set of option descriptors for instrument options that can be specified per context.
This can be specified in addition to options specified on the engine level, instruments may
specify options for each context. Option descriptors specified per context must not overlap
with option descriptors specified per instrument instance.
<p>
Example usage:

<pre>

&#64;Option.Group(MyInstrument.ID)
final class MyContext {

    &#64;Option(category = OptionCategory.EXPERT, help = "Description...")
    static final OptionKey<Boolean> MyContextOption = new OptionKey&lt;&gt;(Boolean.FALSE);
}

&#64;Registration(...)
class MyInstrument extends TruffleInstrument {

  static final OptionDescriptors CONTEXT_OPTIONS = new MyContextOptionDescriptors();

  //...

  protected OptionDescriptors getContextOptionDescriptors() {
     return CONTEXT_OPTIONS;
  }
}
</pre></div>
<dl class="notes">
<dt>Since:</dt>
<dd>20.3</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="TruffleInstrument.Env.html#getOptions(com.oracle.truffle.api.TruffleContext)">to lookup the option values for a context.</a></li>
</ul>
</dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="getSourceOptionDescriptors()">
<h3>getSourceOptionDescriptors</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="modifiers">protected</span>&nbsp;<span class="return-type"><a href="../../../../../org/graalvm/options/OptionDescriptors.html" title="interface in org.graalvm.options">OptionDescriptors</a></span>&nbsp;<span class="element-name">getSourceOptionDescriptors</span>()</div>
<div class="block">Returns a set of source option descriptors that are supported by this language. Option values
are accessible using the <a href="TruffleInstrument.Env.html#getOptions(com.oracle.truffle.api.source.Source)"><code>environment</code></a>. Languages must always
return the same option descriptors independent of the language instance or side-effects.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>25.0</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="../Option.html" title="annotation interface in com.oracle.truffle.api">For an example of declaring the option descriptor using an annotation.</a></li>
<li><a href="#getContextOptionDescriptors()">for another example</a></li>
</ul>
</dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="createContextLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextLocalFactory)">
<h3>createContextLocal</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Deprecated.html" title="class or interface in java.lang" class="external-link">@Deprecated</a>
</span><span class="modifiers">protected final</span>&nbsp;<span class="type-parameters">&lt;T&gt;</span>&nbsp;<span class="return-type"><a href="../ContextLocal.html" title="class in com.oracle.truffle.api">ContextLocal</a>&lt;T&gt;</span>&nbsp;<span class="element-name">createContextLocal</span><wbr><span class="parameters">(<a href="TruffleInstrument.ContextLocalFactory.html" title="interface in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextLocalFactory</a>&lt;T&gt;&nbsp;factory)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span>
<div class="deprecation-comment">in 23.1, use
            <a href="TruffleInstrument.ContextLocalProvider.html#createContextLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextLocal(TruffleInstrument.ContextLocalFactory)</code></a>
            instead</div>
</div>
<div class="block">Creates a new context local reference for this Truffle instrument.

Starting with JDK 21, using this method leads to a this-escape warning. Use
<a href="TruffleInstrument.ContextLocalProvider.html#createContextLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextLocal(TruffleInstrument.ContextLocalFactory)</code></a>
instead.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>20.3</dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="createContextThreadLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextThreadLocalFactory)">
<h3>createContextThreadLocal</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/26/docs/api/java.base/java/lang/Deprecated.html" title="class or interface in java.lang" class="external-link">@Deprecated</a>
</span><span class="modifiers">protected final</span>&nbsp;<span class="type-parameters">&lt;T&gt;</span>&nbsp;<span class="return-type"><a href="../ContextThreadLocal.html" title="class in com.oracle.truffle.api">ContextThreadLocal</a>&lt;T&gt;</span>&nbsp;<span class="element-name">createContextThreadLocal</span><wbr><span class="parameters">(<a href="TruffleInstrument.ContextThreadLocalFactory.html" title="interface in com.oracle.truffle.api.instrumentation">TruffleInstrument.ContextThreadLocalFactory</a>&lt;T&gt;&nbsp;factory)</span></div>
<div class="deprecation-block"><span class="deprecated-label">Deprecated.</span>
<div class="deprecation-comment">in 23.1, use
            <a href="TruffleInstrument.ContextLocalProvider.html#createContextThreadLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextThreadLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextThreadLocal(TruffleInstrument.ContextThreadLocalFactory)</code></a>
            instead</div>
</div>
<div class="block">Creates a new context thread local reference for this Truffle instrument.

Starting with JDK 21, using this method leads to a this-escape warning. Use
<a href="TruffleInstrument.ContextLocalProvider.html#createContextThreadLocal(com.oracle.truffle.api.instrumentation.TruffleInstrument.ContextThreadLocalFactory)"><code>TruffleInstrument.ContextLocalProvider.createContextThreadLocal(TruffleInstrument.ContextThreadLocalFactory)</code></a>
instead.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>20.3</dd>
</dl>
</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><center>Copyright &copy; 2012, 2025, Oracle and/or its affiliates. All rights reserved.</center></small></p>
</footer>
</main>
</div>
</body>
</html>
