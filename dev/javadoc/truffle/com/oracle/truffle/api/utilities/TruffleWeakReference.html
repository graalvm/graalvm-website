<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>TruffleWeakReference (GraalVM Truffle Java API Reference)</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="TruffleWeakReference (GraalVM Truffle Java API Reference)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>GraalVM Truffle Java API Reference<br>23.0.0-dev</b><br>c026de2536315b065e1d11a1e028ec22ab61f9a8</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/oracle/truffle/api/utilities/TriState.html" title="enum in com.oracle.truffle.api.utilities"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/api/utilities/TruffleWeakReference.html" target="_top">Frames</a></li>
<li><a href="TruffleWeakReference.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#methods.inherited.from.class.java.lang.ref.Reference">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.oracle.truffle.api.utilities</div>
<h2 title="Class TruffleWeakReference" class="title">Class TruffleWeakReference&lt;T&gt;</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true" title="class or interface in java.lang.ref">java.lang.ref.Reference</a>&lt;T&gt;</li>
<li>
<ul class="inheritance">
<li><a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/WeakReference.html?is-external=true" title="class or interface in java.lang.ref">java.lang.ref.WeakReference</a>&lt;T&gt;</li>
<li>
<ul class="inheritance">
<li>com.oracle.truffle.api.utilities.TruffleWeakReference&lt;T&gt;</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public final class <span class="typeNameLabel">TruffleWeakReference&lt;T&gt;</span>
extends <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/WeakReference.html?is-external=true" title="class or interface in java.lang.ref">WeakReference</a>&lt;T&gt;</pre>
<div class="block">Creates a new weak reference that is safe to be used in compiled code paths. If a weak reference
 is <a href="../../../../../com/oracle/truffle/api/CompilerDirectives.html#isPartialEvaluationConstant-java.lang.Object-"><code>PE constant</code></a> then the
 <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true#get--" title="class or interface in java.lang.ref"><code>referenced object</code></a> will be
 <a href="../../../../../com/oracle/truffle/api/CompilerDirectives.html#isPartialEvaluationConstant-java.lang.Object-"><code>PE constant</code></a> as well.
 <p>
 When a language is compiled using native-image then a closed world closure of all runtime
 compiled methods is computed. That list of methods can rely on static type information only. If
 the host application or any of the loaded libraries uses custom weak reference sub-classes that
 were not designed for partial evaluation then these method will be listed as runtime compilable
 methods, causing black listed method errors at native-image compilation time. To avoid this
 problem use this custom weak reference subclass which is designed for PE if used as exact class
 of the field.
 <p>
 <b>Wrong usage</b> of weak references in compiled code paths:

 <pre>
 class MyNode extends Node {

     &#64;CompilationFinal private WeakReference<Object> reference;

     Object execute(Object arg) {
         if (reference == null) {
             CompilerDirectives.transferToInterpreterAndInvalidate();
             reference = new WeakReference<>(arg);
         }
         return reference.get();
     }

 }
 </pre>

 <b>Correct usage</b> of weak references in compiled code paths :

 <pre>
 static class MyNode extends Node {

     &#64;CompilationFinal private TruffleWeakReference<Object> reference;

     Object execute(Object arg) {
         if (reference == null) {
             CompilerDirectives.transferToInterpreterAndInvalidate();
             reference = new TruffleWeakReference(arg);
         }
         return reference.get();
     }

 }
 </pre></div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>20.2</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html#TruffleWeakReference-T-">TruffleWeakReference</a></span>(<a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html" title="type parameter in TruffleWeakReference">T</a>&nbsp;t)</code>
<div class="block">Creates a new Truffle weak reference that refers to the given object.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html#TruffleWeakReference-T-java.lang.ref.ReferenceQueue-">TruffleWeakReference</a></span>(<a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html" title="type parameter in TruffleWeakReference">T</a>&nbsp;referent,
                    <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/ReferenceQueue.html?is-external=true" title="class or interface in java.lang.ref">ReferenceQueue</a>&lt;? super <a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html" title="type parameter in TruffleWeakReference">T</a>&gt;&nbsp;q)</code>
<div class="block">Creates a new Truffle weak reference that refers to the given object and is registered with
 the given queue.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.ref.Reference">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.ref.<a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true" title="class or interface in java.lang.ref">Reference</a></h3>
<code><a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true#clear--" title="class or interface in java.lang.ref">clear</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true#clone--" title="class or interface in java.lang.ref">clone</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true#enqueue--" title="class or interface in java.lang.ref">enqueue</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true#get--" title="class or interface in java.lang.ref">get</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true#reachabilityFence-java.lang.Object-" title="class or interface in java.lang.ref">reachabilityFence</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/Reference.html?is-external=true#refersTo-T-" title="class or interface in java.lang.ref">refersTo</a></code></li>
</ul>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#equals-java.lang.Object-" title="class or interface in java.lang">equals</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#getClass--" title="class or interface in java.lang">getClass</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#hashCode--" title="class or interface in java.lang">hashCode</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#notify--" title="class or interface in java.lang">notify</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#notifyAll--" title="class or interface in java.lang">notifyAll</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#toString--" title="class or interface in java.lang">toString</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#wait--" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#wait-long-" title="class or interface in java.lang">wait</a>, <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/Object.html?is-external=true#wait-long-int-" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="TruffleWeakReference-java.lang.Object-">
<!--   -->
</a><a name="TruffleWeakReference-T-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>TruffleWeakReference</h4>
<pre>public&nbsp;TruffleWeakReference(<a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html" title="type parameter in TruffleWeakReference">T</a>&nbsp;t)</pre>
<div class="block">Creates a new Truffle weak reference that refers to the given object. The new reference is
 not registered with any queue.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>20.2</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/WeakReference.html?is-external=true#WeakReference-T-" title="class or interface in java.lang.ref"><code>WeakReference.WeakReference(Object)</code></a></dd>
</dl>
</li>
</ul>
<a name="TruffleWeakReference-java.lang.Object-java.lang.ref.ReferenceQueue-">
<!--   -->
</a><a name="TruffleWeakReference-T-java.lang.ref.ReferenceQueue-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>TruffleWeakReference</h4>
<pre>public&nbsp;TruffleWeakReference(<a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html" title="type parameter in TruffleWeakReference">T</a>&nbsp;referent,
                            <a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/ReferenceQueue.html?is-external=true" title="class or interface in java.lang.ref">ReferenceQueue</a>&lt;? super <a href="../../../../../com/oracle/truffle/api/utilities/TruffleWeakReference.html" title="type parameter in TruffleWeakReference">T</a>&gt;&nbsp;q)</pre>
<div class="block">Creates a new Truffle weak reference that refers to the given object and is registered with
 the given queue.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>20.2</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="http://docs.oracle.com/javase/17/docs/api/java/lang/ref/WeakReference.html?is-external=true#WeakReference-T-java.lang.ref.ReferenceQueue-" title="class or interface in java.lang.ref"><code>WeakReference.WeakReference(Object, ReferenceQueue)</code></a></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>GraalVM Truffle Java API Reference<br>23.0.0-dev</b><br>c026de2536315b065e1d11a1e028ec22ab61f9a8</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/oracle/truffle/api/utilities/TriState.html" title="enum in com.oracle.truffle.api.utilities"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/api/utilities/TruffleWeakReference.html" target="_top">Frames</a></li>
<li><a href="TruffleWeakReference.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#methods.inherited.from.class.java.lang.ref.Reference">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li>Method</li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><center>Copyright &copy; 2012, 2022, Oracle and/or its affiliates. All rights reserved.</center></small></p>
</body>
</html>
