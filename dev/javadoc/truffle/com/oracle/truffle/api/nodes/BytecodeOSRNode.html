<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>BytecodeOSRNode (GraalVM Truffle Java API Reference)</title>
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="BytecodeOSRNode (GraalVM Truffle Java API Reference)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":18,"i1":6,"i2":6,"i3":17,"i4":18,"i5":18,"i6":18,"i7":6,"i8":18,"i9":17};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"],16:["t5","Default Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>GraalVM Truffle Java API Reference<br>24.0.0-dev</b><br>fe3452f9280d1343436cf3cb7f18b615c80d011c</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/oracle/truffle/api/nodes/BlockNode.ElementExecutor.html" title="interface in com.oracle.truffle.api.nodes"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/oracle/truffle/api/nodes/ControlFlowException.html" title="class in com.oracle.truffle.api.nodes"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/api/nodes/BytecodeOSRNode.html" target="_top">Frames</a></li>
<li><a href="BytecodeOSRNode.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">com.oracle.truffle.api.nodes</div>
<h2 title="Interface BytecodeOSRNode" class="title">Interface BytecodeOSRNode</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Superinterfaces:</dt>
<dd><a href="../../../../../com/oracle/truffle/api/nodes/NodeInterface.html" title="interface in com.oracle.truffle.api.nodes">NodeInterface</a></dd>
</dl>
<hr>
<br>
<pre>public interface <span class="typeNameLabel">BytecodeOSRNode</span>
extends <a href="../../../../../com/oracle/truffle/api/nodes/NodeInterface.html" title="interface in com.oracle.truffle.api.nodes">NodeInterface</a></pre>
<div class="block">Interface for Truffle bytecode nodes which can be on-stack replaced (OSR).
 <p>
 There are a few restrictions Bytecode OSR nodes must satisfy in order for OSR to work correctly:
 <ol>
 <li>The node must extend <a href="../../../../../com/oracle/truffle/api/nodes/Node.html" title="class in com.oracle.truffle.api.nodes"><code>Node</code></a> or a subclass of <a href="../../../../../com/oracle/truffle/api/nodes/Node.html" title="class in com.oracle.truffle.api.nodes"><code>Node</code></a>.</li>
 <li>The node must provide storage for the OSR metadata maintained by the runtime using an
 instance field. The field must be
 <a href="../../../../../com/oracle/truffle/api/CompilerDirectives.CompilationFinal.html" title="annotation in com.oracle.truffle.api"><code>@CompilationFinal</code></a>, and the
 <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#getOSRMetadata--"><code>BytecodeOSRNode.getOSRMetadata()</code></a> and <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#setOSRMetadata-java.lang.Object-"><code>BytecodeOSRNode.setOSRMetadata(java.lang.Object)</code></a> methods must
 proxy accesses to it.</li>
 <li>The node should call <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#pollOSRBackEdge-com.oracle.truffle.api.nodes.BytecodeOSRNode-"><code>BytecodeOSRNode.pollOSRBackEdge(com.oracle.truffle.api.nodes.BytecodeOSRNode)</code></a> and
 <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#tryOSR-com.oracle.truffle.api.nodes.BytecodeOSRNode-int-java.lang.Object-java.lang.Runnable-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.tryOSR(com.oracle.truffle.api.nodes.BytecodeOSRNode, int, java.lang.Object, java.lang.Runnable, com.oracle.truffle.api.frame.VirtualFrame)</code></a> as described by their documentation.</li>
 </ol>

 <p>
 For performance reasons, the parent frame may be copied into a new frame used for OSR. If this
 happens, <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#copyIntoOSRFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-"><code>BytecodeOSRNode.copyIntoOSRFrame(VirtualFrame, VirtualFrame, int, Object)</code></a> is
 used to perform the copy, and <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#restoreParentFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.restoreParentFrame(com.oracle.truffle.api.frame.VirtualFrame, com.oracle.truffle.api.frame.VirtualFrame)</code></a> is used to copy the OSR
 frame contents back into the parent frame after OSR. A node may override these methods; by
 default, they perform slot-wise copies.

 <p>
 A node may also wish to override <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#prepareOSR-int-"><code>BytecodeOSRNode.prepareOSR(int)</code></a> to perform initialization.
 This method will be called before compilation, and can be useful to avoid deoptimizing inside
 compiled code.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t5" class="tableTab"><span><a href="javascript:show(16);">Default Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>default void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#copyIntoOSRFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-">copyIntoOSRFrame</a></span>(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;osrFrame,
                <a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame,
                int&nbsp;target,
                <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;targetMetadata)</code>
<div class="block">Copies the contents of the <code>parentFrame</code> into the <code>osrFrame</code> used to execute OSR.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#executeOSR-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-">executeOSR</a></span>(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;osrFrame,
          int&nbsp;target,
          <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;interpreterState)</code>
<div class="block">Entrypoint to invoke this node through OSR.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#getOSRMetadata--">getOSRMetadata</a></span>()</code>
<div class="block">Gets the OSR metadata for this instance.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#pollOSRBackEdge-com.oracle.truffle.api.nodes.BytecodeOSRNode-">pollOSRBackEdge</a></span>(<a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html" title="interface in com.oracle.truffle.api.nodes">BytecodeOSRNode</a>&nbsp;osrNode)</code>
<div class="block">Reports a back edge, returning whether to try performing OSR.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>default void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#prepareOSR-int-">prepareOSR</a></span>(int&nbsp;target)</code>
<div class="block">Initialization hook which will be invoked before OSR compilation.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>default void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#restoreParentFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-">restoreParentFrame</a></span>(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;osrFrame,
                  <a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame)</code>
<div class="block">Restores the contents of the <code>osrFrame</code> back into the <code>parentFrame</code> after OSR.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>default <a href="../../../../../com/oracle/truffle/api/frame/Frame.html" title="interface in com.oracle.truffle.api.frame">Frame</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#restoreParentFrameFromArguments-java.lang.Object:A-">restoreParentFrameFromArguments</a></span>(<a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>[]&nbsp;arguments)</code>
<div class="block">Return the parent frame that was stored in an arguments array by a previous call to
 <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#storeParentFrameInArguments-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.storeParentFrameInArguments(com.oracle.truffle.api.frame.VirtualFrame)</code></a>.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#setOSRMetadata-java.lang.Object-">setOSRMetadata</a></span>(<a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;osrMetadata)</code>
<div class="block">Sets the OSR metadata for this instance.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>default <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#storeParentFrameInArguments-com.oracle.truffle.api.frame.VirtualFrame-">storeParentFrameInArguments</a></span>(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame)</code>
<div class="block">Produce the arguments that will be used to perform the call to the new OSR root.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>static <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#tryOSR-com.oracle.truffle.api.nodes.BytecodeOSRNode-int-java.lang.Object-java.lang.Runnable-com.oracle.truffle.api.frame.VirtualFrame-">tryOSR</a></span>(<a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html" title="interface in com.oracle.truffle.api.nodes">BytecodeOSRNode</a>&nbsp;osrNode,
      int&nbsp;target,
      <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;interpreterState,
      <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a>&nbsp;beforeTransfer,
      <a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame)</code>
<div class="block">Tries to perform OSR.</div>
</td>
</tr>
</table>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="executeOSR-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>executeOSR</h4>
<pre><a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;executeOSR(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;osrFrame,
                  int&nbsp;target,
                  <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;interpreterState)</pre>
<div class="block">Entrypoint to invoke this node through OSR. This method should execute from the
 <code>target</code> location.

 <p>
 The <code>osrFrame</code> may be the parent frame, but for performance reasons could also be a new
 frame. In case a new frame is created, the frame's <a href="../../../../../com/oracle/truffle/api/frame/Frame.html#getArguments--"><code>arguments</code></a>
 will be provided by <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#storeParentFrameInArguments-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.storeParentFrameInArguments(com.oracle.truffle.api.frame.VirtualFrame)</code></a>.

 <p>
 Typically, a bytecode node's <a href="../../../../../com/oracle/truffle/api/nodes/ExecutableNode.html#execute-com.oracle.truffle.api.frame.VirtualFrame-"><code>execute(VirtualFrame)</code></a> method already contains a dispatch loop. This loop can be extracted
 into a separate method which can also be used by this method. For example:

 <pre>
 Object execute(VirtualFrame frame) {
   return dispatchFromBCI(frame, 0);
 }
 Object executeOSR(VirtualFrame osrFrame, int target, Object interpreterState) {
   return dispatchFromBCI(osrFrame, target);
 }
 Object dispatchFromBCI(VirtualFrame frame, int bci) {
     // main dispatch loop
     while(true) {
         switch(instructions[bci]) {
             ...
         }
     }
 }
 </pre></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>osrFrame</code> - the frame to use for OSR.</dd>
<dd><code>target</code> - the target location to execute from (e.g., bytecode index).</dd>
<dd><code>interpreterState</code> - other interpreter state used to resume execution. See
            <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#tryOSR-com.oracle.truffle.api.nodes.BytecodeOSRNode-int-java.lang.Object-java.lang.Runnable-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.tryOSR(com.oracle.truffle.api.nodes.BytecodeOSRNode, int, java.lang.Object, java.lang.Runnable, com.oracle.truffle.api.frame.VirtualFrame)</code></a> for more details.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the result of execution.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
<a name="getOSRMetadata--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getOSRMetadata</h4>
<pre><a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;getOSRMetadata()</pre>
<div class="block">Gets the OSR metadata for this instance.
 <p>
 The metadata must be stored on a
 <a href="../../../../../com/oracle/truffle/api/CompilerDirectives.CompilationFinal.html" title="annotation in com.oracle.truffle.api"><code>@CompilationFinal</code></a> instance
 field. Refer to the documentation for this interface for a more complete description.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the OSR metadata.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
<a name="setOSRMetadata-java.lang.Object-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setOSRMetadata</h4>
<pre>void&nbsp;setOSRMetadata(<a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;osrMetadata)</pre>
<div class="block">Sets the OSR metadata for this instance.
 <p>
 The metadata must be stored on a
 <a href="../../../../../com/oracle/truffle/api/CompilerDirectives.CompilationFinal.html" title="annotation in com.oracle.truffle.api"><code>@CompilationFinal</code></a> instance
 field. Refer to the documentation for this interface for a more complete description.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>osrMetadata</code> - the OSR metadata.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
<a name="copyIntoOSRFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>copyIntoOSRFrame</h4>
<pre>default&nbsp;void&nbsp;copyIntoOSRFrame(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;osrFrame,
                              <a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame,
                              int&nbsp;target,
                              <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;targetMetadata)</pre>
<div class="block">Copies the contents of the <code>parentFrame</code> into the <code>osrFrame</code> used to execute OSR.
 By default, performs a slot-wise copy of the frame.

 <p>
 NOTE: This method is only used if the Truffle runtime decides to copy the frame. OSR may also
 reuse the parent frame directly.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>osrFrame</code> - the frame to use for OSR.</dd>
<dd><code>parentFrame</code> - the frame used before performing OSR.</dd>
<dd><code>target</code> - the target location OSR will execute from (e.g., bytecode index).</dd>
<dd><code>targetMetadata</code> - Additional metadata associated with this <code>target</code> for the default
            frame transfer behavior.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>22.2</dd>
</dl>
</li>
</ul>
<a name="restoreParentFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>restoreParentFrame</h4>
<pre>default&nbsp;void&nbsp;restoreParentFrame(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;osrFrame,
                                <a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame)</pre>
<div class="block">Restores the contents of the <code>osrFrame</code> back into the <code>parentFrame</code> after OSR. By
 default, performs a slot-wise copy of the frame.
 <p>
 Though a bytecode interpreter might not explicitly use <code>parentFrame</code> after OSR, it is
 necessary to restore the state into <code>parentFrame</code> if it may be accessed through
 instrumentation.

 <p>
 NOTE: This method is only used if the Truffle runtime decided to copy the frame using
 <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#copyIntoOSRFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-"><code>BytecodeOSRNode.copyIntoOSRFrame(VirtualFrame, VirtualFrame, int, Object)</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>osrFrame</code> - the frame which was used for OSR.</dd>
<dd><code>parentFrame</code> - the frame which will be used by the parent after returning from OSR.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
<a name="prepareOSR-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>prepareOSR</h4>
<pre>default&nbsp;void&nbsp;prepareOSR(int&nbsp;target)</pre>
<div class="block">Initialization hook which will be invoked before OSR compilation. This hook can be used to
 perform any necessary initialization before compilation happens.

 <p>
 For example, consider a field which must be initialized in the interpreter:

 <pre>
  @CompilationFinal Object field;
 Object getField() {
     if (field == null) {
         CompilerDirectives.transferToInterpreterAndInvalidate();
         field = new Object();
     }
     return field;
 }
 </pre>
 <p>
 If the field is accessed from compiled OSR code, it may trigger a deoptimization in order to
 initialize the field. Using <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#prepareOSR-int-"><code>BytecodeOSRNode.prepareOSR(int)</code></a> to initialize the field can
 prevent this.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>target</code> - the target location OSR will execute from (e.g., bytecode index).</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
<a name="pollOSRBackEdge-com.oracle.truffle.api.nodes.BytecodeOSRNode-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>pollOSRBackEdge</h4>
<pre>static&nbsp;boolean&nbsp;pollOSRBackEdge(<a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html" title="interface in com.oracle.truffle.api.nodes">BytecodeOSRNode</a>&nbsp;osrNode)</pre>
<div class="block">Reports a back edge, returning whether to try performing OSR.

 <p>
 An interpreter must ensure this method returns <code>true</code> immediately before calling
 <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#tryOSR-com.oracle.truffle.api.nodes.BytecodeOSRNode-int-java.lang.Object-java.lang.Runnable-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.tryOSR(com.oracle.truffle.api.nodes.BytecodeOSRNode, int, java.lang.Object, java.lang.Runnable, com.oracle.truffle.api.frame.VirtualFrame)</code></a>. For example:

 <pre>
 if (BytecodeOSRNode.pollOSRBackEdge(this)) {
   Object osrResult = BytecodeOSRNode.tryOSR(...);
   ...
 }
 </pre></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>osrNode</code> - the node to report a back-edge for.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>whether to try OSR.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
<a name="tryOSR-com.oracle.truffle.api.nodes.BytecodeOSRNode-int-java.lang.Object-java.lang.Runnable-com.oracle.truffle.api.frame.VirtualFrame-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>tryOSR</h4>
<pre>static&nbsp;<a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;tryOSR(<a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html" title="interface in com.oracle.truffle.api.nodes">BytecodeOSRNode</a>&nbsp;osrNode,
                     int&nbsp;target,
                     <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>&nbsp;interpreterState,
                     <a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Runnable.html?is-external=true" title="class or interface in java.lang">Runnable</a>&nbsp;beforeTransfer,
                     <a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame)</pre>
<div class="block">Tries to perform OSR. This method must only be called immediately after a <code>true</code> result
 from <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#pollOSRBackEdge-com.oracle.truffle.api.nodes.BytecodeOSRNode-"><code>BytecodeOSRNode.pollOSRBackEdge(com.oracle.truffle.api.nodes.BytecodeOSRNode)</code></a>.

 <p>
 Depending on the Truffle runtime, this method can trigger OSR compilation and then (typically
 in a subsequent call) transfer to OSR code. If OSR occurs, this method returns the result of
 OSR execution. The caller of this method can forward the result back to its caller rather
 than continuing execution from the <code>target</code>. For example:

 <pre>
 if (BytecodeOSRNode.pollOSRBackEdge(this)) {
   Object osrResult = BytecodeOSRNode.tryOSR(...);
   if (osrResult != null) return osrResult;
 }
 </pre>
 <p>
 The optional <code>interpreterState</code> parameter will be forwarded to
 <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#executeOSR-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-"><code>BytecodeOSRNode.executeOSR(com.oracle.truffle.api.frame.VirtualFrame, int, java.lang.Object)</code></a> when OSR is performed. It should consist of additional
 interpreter state (e.g., data pointers) needed to resume execution from <code>target</code>. The
 state should be fixed (i.e., final) for the given <code>target</code>. For example:

 <pre>
 // class definition
 class InterpreterState {
     final int dataPtr;
     InterpreterState(int dataPtr) { ... }
 }

 // call site
 Object osrResult = BytecodeOSRNode.tryOSR(this, target, new InterpreterState(dataPtr), ...);

 // executeOSR
 Object executeOSR(VirtualFrame osrFrame, int target, Object interpreterState) {
     InterpreterState state = (InterpreterState) interpreterState;
     return dispatchFromBCI(osrFrame, target, interpreterState.dataPtr);
 }
 </pre>
 <p>
 The optional <code>beforeTransfer</code> callback will be called before transferring control to
 the OSR target. Since this method may or may not perform a transfer, it is a way to ensure
 certain actions (e.g., instrumentation events) occur before transferring to OSR code. For
 example:

 <pre>
 // call site
 Object osrResult = BytecodeNode.tryOSR(this, target, ..., () -> {
    instrument.notify(current, target);
 });
 </pre></div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>osrNode</code> - the node to try OSR for.</dd>
<dd><code>target</code> - the target location OSR will execute from (e.g., bytecode index).</dd>
<dd><code>interpreterState</code> - other interpreter state used to resume execution.</dd>
<dd><code>beforeTransfer</code> - a callback invoked before OSR. Can be <code>null</code>.</dd>
<dd><code>parentFrame</code> - frame at the current point of execution.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the result if OSR was performed, or <code>null</code> otherwise.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>21.3</dd>
</dl>
</li>
</ul>
<a name="storeParentFrameInArguments-com.oracle.truffle.api.frame.VirtualFrame-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>storeParentFrameInArguments</h4>
<pre>default&nbsp;<a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>[]&nbsp;storeParentFrameInArguments(<a href="../../../../../com/oracle/truffle/api/frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame">VirtualFrame</a>&nbsp;parentFrame)</pre>
<div class="block">Produce the arguments that will be used to perform the call to the new OSR root. It will
 become the arguments array of the frame passed into <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#executeOSR-com.oracle.truffle.api.frame.VirtualFrame-int-java.lang.Object-"><code>BytecodeOSRNode.executeOSR(com.oracle.truffle.api.frame.VirtualFrame, int, java.lang.Object)</code></a> in case a new frame
 is generated for the call for performance reasons. The contents are up to language, Truffle
 only requires that a subsequent call to <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#restoreParentFrame-com.oracle.truffle.api.frame.VirtualFrame-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.restoreParentFrame(com.oracle.truffle.api.frame.VirtualFrame, com.oracle.truffle.api.frame.VirtualFrame)</code></a> with the arguments array
 will return the same object as was passed into the <code>parentFrame</code> argument. By default,
 this method creates a new one-element array, which discards the original frame arguments.
 Override this method to be able to preserve a subset of the original frame arguments. It is
 permitted to modify arguments array of <code>parentFrame</code> and return it. This is called only
 in the interpreter, therefore the frame is not virtual and it is safe to store it into the
 arguments array.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>parentFrame</code> - the frame object to be stored in the resulting arguments array</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>arguments array containing <code>parentFrame</code></dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>22.2</dd>
</dl>
</li>
</ul>
<a name="restoreParentFrameFromArguments-java.lang.Object:A-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>restoreParentFrameFromArguments</h4>
<pre>default&nbsp;<a href="../../../../../com/oracle/truffle/api/frame/Frame.html" title="interface in com.oracle.truffle.api.frame">Frame</a>&nbsp;restoreParentFrameFromArguments(<a href="http://docs.oracle.com/javase/21/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a>[]&nbsp;arguments)</pre>
<div class="block">Return the parent frame that was stored in an arguments array by a previous call to
 <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#storeParentFrameInArguments-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.storeParentFrameInArguments(com.oracle.truffle.api.frame.VirtualFrame)</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>arguments</code> - frame arguments originally produced by <a href="../../../../../com/oracle/truffle/api/nodes/BytecodeOSRNode.html#storeParentFrameInArguments-com.oracle.truffle.api.frame.VirtualFrame-"><code>BytecodeOSRNode.storeParentFrameInArguments(com.oracle.truffle.api.frame.VirtualFrame)</code></a>.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>stored parent frame</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>22.2</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
<div class="aboutLanguage"><b>GraalVM Truffle Java API Reference<br>24.0.0-dev</b><br>fe3452f9280d1343436cf3cb7f18b615c80d011c</div>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../com/oracle/truffle/api/nodes/BlockNode.ElementExecutor.html" title="interface in com.oracle.truffle.api.nodes"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../com/oracle/truffle/api/nodes/ControlFlowException.html" title="class in com.oracle.truffle.api.nodes"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/oracle/truffle/api/nodes/BytecodeOSRNode.html" target="_top">Frames</a></li>
<li><a href="BytecodeOSRNode.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small><center>Copyright &copy; 2012, 2023, Oracle and/or its affiliates. All rights reserved.</center></small></p>
</body>
</html>
