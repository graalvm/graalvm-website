<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (21) -->
<title>CachedLibrary (GraalVM Truffle Java API Reference)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.oracle.truffle.api.library, annotation type: CachedLibrary">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<div class="about-language"><b>GraalVM Truffle Java API Reference<br>24.2.0-dev</b><br>c006c5de059768ada712a9809e72582ce0ef0079</div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li>Field</li>
<li>Required</li>
<li><a href="#annotation-interface-optional-element-summary">Optional</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#annotation-interface-element-detail">Element</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Required&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-optional-element-summary">Optional</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#annotation-interface-element-detail">Element</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.oracle.truffle.api.library</a></div>
<h1 title="Annotation Interface CachedLibrary" class="title">Annotation Interface CachedLibrary</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="type-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/annotation/Retention.html" title="class or interface in java.lang.annotation" class="external-link">@Retention</a>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/annotation/RetentionPolicy.html#CLASS" title="class or interface in java.lang.annotation" class="external-link">CLASS</a>)
<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/annotation/Target.html" title="class or interface in java.lang.annotation" class="external-link">@Target</a>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/annotation/ElementType.html#PARAMETER" title="class or interface in java.lang.annotation" class="external-link">PARAMETER</a>)
</span><span class="modifiers">public @interface </span><span class="element-name type-name-label">CachedLibrary</span></div>
<div class="block">The cached library annotation allows to use <a href="package-summary.html"><code>Truffle
 Libraries</code></a> conveniently in <a href="../dsl/Specialization.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>specializations</code></a> or <a href="ExportMessage.html" title="annotation interface in com.oracle.truffle.api.library"><code>exported messages</code></a>. It is designed as the primary way of using libraries. The
 <a href="CachedLibrary.html" title="annotation interface in com.oracle.truffle.api.library"><code>CachedLibrary</code></a> annotation may be used for any parameters of methods annotated with
 <a href="../dsl/Specialization.html" title="annotation interface in com.oracle.truffle.api.dsl">@Specialization</a> or <a href="ExportMessage.html" title="annotation interface in com.oracle.truffle.api.library">@ExportMessage</a>.

 <h3 id="using-specialized-libraries-heading">Using Specialized Libraries</h3>

 A cached library can be specialized for a value that is referred to with the <a href="#value()"><code>value expression</code></a> attribute. A specialized library implicitly prepends a guard for the
 <a href="Library.html#accepts(java.lang.Object)"><code>acceptance</code></a> of a library with the provided value expression.
 Adding the acceptance guard leads to multiple specialization instances as it binds to the cached
 library value. The <a href="../dsl/Specialization.html#limit()"><code>specialization</code></a> or <a href="ExportMessage.html#limit()"><code>export</code></a> limit attribute must therefore be specified. If this limit overflows then the operation
 will rewrite itself to an <a href="LibraryFactory.html#getUncached(java.lang.Object)"><code>uncached</code></a> version of the
 library. Multiple specialized libraries may be used per export or specialization. The acceptance
 guards for these libraries will be added in the order of their declaration.
 <p>
 <h4 id="usage--heading">Usage:</h4>

 <pre>
 &#64;NodeChild
 &#64;NodeChild
 abstract static class ArrayReadNode extends ExpressionNode {
     &#64;Specialization(guards = "arrays.isArray(array)", limit = "2")
     int doDefault(Object array, int index,
                     &#64;CachedLibrary("array") ArrayLibrary arrays) {
         return arrays.read(array, index);
     }
 }
 </pre>

 <p>
 It is recommended to use the plural of the specialized parameter name as naming convention for
 the library parameter name, e.g. a library for an <code>array</code> value is called
 <code>arrays</code>. If multiple libraries are specialized for the same specialized expression it
 is recommended to prepend the library name e.g. <code>interopArrays</code>.

 <h3 id="using-dispatched-libraries-heading">Using Dispatched Libraries</h3>
 <p>
 If no specialized value expression can be specified, i.e. if the value is computed as part of the
 operation, then a dispatched version of a library can be used by omitting the <a href="#value()"><code>value</code></a> attribute and specifying the <a href="#limit()"><code>limit()</code></a> attribute instead. A dispatched library
 builds the specialized value inline cache internally for each invocation of a message instead of
 once per outer specialization or export. An instance of a dispatched library therefore
 <a href="Library.html#accepts(java.lang.Object)"><code>accepts</code></a> any value as receiver. It is recommended to use the same
 generic library instance for few message invocations of similar values only, could lead to
 duplication of inline cache dispatches in the compiled code. The limit of a dispatched library
 may be set to 0 to directly switch to an uncached version of a library.
 <p>

 <h4 id="usage--heading1">Usage:</h4>

 The following example combines the use of specialized and dispatched libraries. In this example
 the array is read twice. For the first <i>outer</i> read the specializing expression can be used.
 For the second read the specializing expression cannot be used as it depends on the result of the
 outer read. We therefore use a dispatched library for the inner array.

 <pre>
 &#64;NodeChild
 &#64;NodeChild
 &#64;NodeChild
 abstract static class TwoDimReadNode extends ExpressionNode {
     &#64;Specialization(guards = "outerArrays.isArray(array)", limit = "2")
     int doDefault(Object array, int outerIndex, int innerIndex,
                     &#64;CachedLibrary("array") ArrayLibrary outerArrays,
                     &#64;CachedLibrary(limit = "2") ArrayLibrary innerArrays) {
         return innerArrays.read(outerArrays.read(outerIndex), innerIndex);
     }
 }
 </pre></div>
<dl class="notes">
<dt>Since:</dt>
<dd>19.0</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="LibraryFactory.html" title="class in com.oracle.truffle.api.library"><code>for manually instantiating libraries</code></a></li>
<li><a href="package-summary.html"><code>Truffle Library reference documentation</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== ANNOTATION INTERFACE OPTIONAL MEMBER SUMMARY =========== -->
<li>
<section class="member-summary" id="annotation-interface-optional-element-summary">
<h2>Optional Element Summary</h2>
<div class="caption"><span>Optional Elements</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Optional Element</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color"><code><a href="#limit()" class="member-name-link">limit</a></code></div>
<div class="col-last even-row-color">
<div class="block">Sets the limit expression when using dispatched libraries.</div>
</div>
<div class="col-first odd-row-color"><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color"><code><a href="#value()" class="member-name-link">value</a></code></div>
<div class="col-last odd-row-color">
<div class="block">Sets the specialized value expression when using specialized libraries.</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details" id="annotation-interface-element-detail">
<ul class="details-list">
<!-- ============ ANNOTATION INTERFACE MEMBER DETAIL =========== -->
<li>
<section class="member-details">
<h2>Element Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="value()">
<h3>value</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">value</span></div>
<div class="block">Sets the specialized value expression when using specialized libraries. The same syntax
 applies as for <a href="../dsl/Cached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Cached</code></a> value expressions.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>19.0</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="CachedLibrary.html" title="annotation interface in com.oracle.truffle.api.library"><code>for usage examples.</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>""</code></dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="limit()">
<h3>limit</h3>
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">limit</span></div>
<div class="block">Sets the limit expression when using dispatched libraries. The limit expression sets the
 number of internally dispatched specialized libraries until an
 <a href="LibraryFactory.html#getUncached()"><code>uncached</code></a> version of the library will be used.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>19.0</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="CachedLibrary.html" title="annotation interface in com.oracle.truffle.api.library"><code>for usage examples.</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>""</code></dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><center>Copyright &copy; 2012, 2024, Oracle and/or its affiliates. All rights reserved.</center></small></p>
</footer>
</div>
</div>
</body>
</html>
