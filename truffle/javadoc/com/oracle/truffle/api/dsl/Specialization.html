<!DOCTYPE HTML>
<html lang="en">
<head>
<!-- Generated by javadoc (25) -->
<title>Specialization (GraalVM Truffle Java API Reference)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="declaration: package: com.oracle.truffle.api.dsl, annotation type: Specialization">
<meta name="generator" content="javadoc/ClassWriter">
<link rel="stylesheet" type="text/css" href="../../../../../resource-files/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="../../../../../resource-files/stylesheet.css">
<script type="text/javascript" src="../../../../../script-files/script.js"></script>
<script type="text/javascript" src="../../../../../script-files/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../script-files/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">const pathtoroot = "../../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top">
<div class="nav-content">
<div class="nav-menu-button"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button></div>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../search.html">Search</a></li>
<li><a href="../../../../../help-doc.html#class">Help</a></li>
</ul>
<div class="about-language"><b>GraalVM Truffle Java API Reference<br>25.1.0-dev</b><br>5d53f8966c889edd3b4a7e817dc022f95b0448d5</div>
</div>
</div>
<div class="sub-nav">
<div class="nav-content">
<ol class="sub-nav-list">
<li><a href="package-summary.html">com.oracle.truffle.api.dsl</a></li>
<li><a href="Specialization.html" class="current-selection">Specialization</a></li>
</ol>
<div class="nav-list-search"><input type="text" id="search-input" disabled placeholder="Search documentation (type /)" aria-label="Search in documentation" autocomplete="off" spellcheck="false"><input type="reset" id="reset-search" disabled value="Reset"></div>
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="main-grid">
<nav role="navigation" class="toc" aria-label="Table of contents">
<div class="toc-header">Contents&nbsp;<input type="text" class="filter-input" disabled placeholder="Filter contents (type .)" aria-label="Filter table of contents" autocomplete="off" spellcheck="false"><input type="reset" class="reset-filter" disabled tabindex="-1" value="Reset"></div>
<ol class="toc-list" tabindex="-1">
<li><a href="#" tabindex="0">Description</a></li>
<li><a href="#annotation-interface-optional-element-summary" tabindex="0">Optional Element Summary</a></li>
<li><a href="#annotation-interface-element-detail" tabindex="0">Element Details</a>
<ol class="toc-list">
<li><a href="#insertBefore()" tabindex="0">insertBefore</a></li>
<li><a href="#rewriteOn()" tabindex="0">rewriteOn</a></li>
<li><a href="#replaces()" tabindex="0">replaces</a></li>
<li><a href="#guards()" tabindex="0">guards</a></li>
<li><a href="#assumptions()" tabindex="0">assumptions</a></li>
<li><a href="#limit()" tabindex="0">limit</a></li>
<li><a href="#unroll()" tabindex="0">unroll</a></li>
<li><a href="#excludeForUncached()" tabindex="0">excludeForUncached</a></li>
</ol>
</li>
</ol>
<button class="hide-sidebar"><span>Hide sidebar&nbsp;</span><img src="../../../../../resource-files/left.svg" alt="Hide sidebar"></button><button class="show-sidebar"><img src="../../../../../resource-files/right.svg" alt="Show sidebar"><span>&nbsp;Show sidebar</span></button></nav>
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<h1 title="Annotation Interface Specialization" class="title">Annotation Interface Specialization</h1>
</div>
<section class="class-description" id="class-description">
<hr>
<div class="horizontal-scroll">
<div class="type-signature"><span class="annotations"><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/annotation/Retention.html" title="class or interface in java.lang.annotation" class="external-link">@Retention</a>(<a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/annotation/RetentionPolicy.html#RUNTIME" title="class or interface in java.lang.annotation" class="external-link">RUNTIME</a>)
<a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/annotation/Target.html" title="class or interface in java.lang.annotation" class="external-link">@Target</a>(<a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/annotation/ElementType.html#METHOD" title="class or interface in java.lang.annotation" class="external-link">METHOD</a>)
</span><span class="modifiers">public @interface </span><span class="element-name type-name-label">Specialization</span></div>
<div class="block"><p>
Defines a method of a node subclass to represent one specialization of an operation. Multiple
specializations can be defined in a node representing an operation. A specialization defines
which kind of input is expected using the method signature and the annotation attributes. The
specialized semantics of the operation are defined using the body of the annotated Java method. A
specialization method must be declared in a class that is derived from <a href="../nodes/Node.html" title="class in com.oracle.truffle.api.nodes"><code>Node</code></a> that
references a <a href="TypeSystem.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>TypeSystem</code></a>. At least one specialization must be defined per operation. If no
specialization is valid for the given set of input values then an
<a href="UnsupportedSpecializationException.html" title="class in com.oracle.truffle.api.dsl"><code>UnsupportedSpecializationException</code></a> is thrown instead of invoking any specialization
method.
</p>
<p>
A specialization must have at least as many parameters as there are <a href="NodeChild.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>NodeChild</code></a> annotations
declared for the enclosing operation node. These parameters are declared in the same order as the
<a href="NodeChild.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>NodeChild</code></a> annotations (linear execution order). We call such parameters dynamic input
parameters. Every specialization that is declared within an operation must have an equal number
of dynamic input parameters.
</p>
<p>
The supported kind of input values for a specialization are declared using guards. A
specialization may provide declarative specifications for four kinds of guards:
<ul>
<li><b>Type guards</b> optimistically assume the type of an input value. A value that matches the
type is cast to its expected type automatically. Type guards are modeled using the parameter type
of the specialization method. Types used for type guards must be defined in the
<a href="TypeSystem.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>TypeSystem</code></a>. If the type of the parameter is <a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link"><code>Object</code></a> then no type guard is used for
the dynamic input parameter.</li>

<li><b>Expression guards</b> optimistically assume the return value of a user-defined expression
to be <code>true</code>. Expression guards are modeled using Java expressions that return a
<code>boolean</code> value. If the guard expression returns <code>false</code>, the
specialization is no longer applicable and the operation is re-specialized. Guard expressions are
declared using the <a href="#guards()"><code>guards()</code></a> attribute.</li>

<li><b>Event guards</b> trigger re-specialization in case an exception is thrown in the
specialization body. The <a href="#rewriteOn()"><code>rewriteOn()</code></a> attribute can be used to declare a list of such
exceptions. Guards of this kind are useful to avoid calculating a value twice when it is used in
the guard and its specialization.</li>

<li><b>Assumption guards</b> optimistically assume that the state of an <a href="../Assumption.html" title="interface in com.oracle.truffle.api"><code>Assumption</code></a>
remains <code>true</code>. Assumptions can be assigned to specializations using the
<a href="#assumptions()"><code>assumptions()</code></a> attribute.</li>
</ul>
</p>
<p>
The enclosing <a href="../nodes/Node.html" title="class in com.oracle.truffle.api.nodes"><code>Node</code></a> of a specialization method must have at least one <code>public</code>
and non-<code>final</code> execute method. An execute method is a method that starts with
'execute'. If all execute methods declare the first parameter type as <a href="../frame/Frame.html" title="interface in com.oracle.truffle.api.frame"><code>Frame</code></a>,
<a href="../frame/VirtualFrame.html" title="interface in com.oracle.truffle.api.frame"><code>VirtualFrame</code></a> or <a href="../frame/MaterializedFrame.html" title="interface in com.oracle.truffle.api.frame"><code>MaterializedFrame</code></a> then the same frame type can be used as
optional first parameter of the specialization. This parameter does not count to the number of
dynamic parameters.
</p>
<p>
A specialization method may declare multiple parameters annotated with <a href="Cached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Cached</code></a>. Cached
parameters are initialized and stored once per specialization instantiation. For consistency
between specialization declarations cached parameters must be declared last in a specialization
method.
</p>
<p>
If the operation is re-specialized or if it is executed for the first time then all declared
specializations of the operation are tried in declaration order until the guards of the first
specialization accepts the current input values. The new specialization is then added to the
chain of current specialization instances which might consist of one (monomorph) or multiple
instances (polymorph). If an assumption of an instantiated specialization is violated then
re-specialization is triggered again.
</p>
<p>
With guards in combination with cached parameters it is possible that multiple instances of the
same specialization are created. The <a href="#limit()"><code>limit()</code></a> attribute can be used to limit the number
of instantiations per specialization.
</p></div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.8 or earlier</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="NodeChild.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>NodeChild</code></a></li>
<li><a href="Fallback.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Fallback</code></a></li>
<li><a href="Cached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Cached</code></a></li>
<li><a href="TypeSystem.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>TypeSystem</code></a></li>
<li><a href="TypeSystemReference.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>TypeSystemReference</code></a></li>
<li><a href="UnsupportedSpecializationException.html" title="class in com.oracle.truffle.api.dsl"><code>UnsupportedSpecializationException</code></a></li>
</ul>
</dd>
</dl>
</div>
</section>
<section class="summary">
<ul class="summary-list">
<!-- =========== ANNOTATION INTERFACE OPTIONAL MEMBER SUMMARY =========== -->
<li>
<section class="member-summary" id="annotation-interface-optional-element-summary">
<h2>Optional Element Summary</h2>
<div class="caption"><span>Optional Elements</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Optional Element</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</code></div>
<div class="col-second even-row-color"><code><a href="#assumptions()" class="member-name-link">assumptions</a></code></div>
<div class="col-last even-row-color">
<div class="block">
Declares assumption guards that optimistically assume that the state of an <a href="../Assumption.html" title="interface in com.oracle.truffle.api"><code>Assumption</code></a>
remains valid.</div>
</div>
<div class="col-first odd-row-color"><code>boolean</code></div>
<div class="col-second odd-row-color"><code><a href="#excludeForUncached()" class="member-name-link">excludeForUncached</a></code></div>
<div class="col-last odd-row-color">
<div class="block">Excludes this specialization from use with <a href="GenerateUncached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>GenerateUncached</code></a>.</div>
</div>
<div class="col-first even-row-color"><code><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</code></div>
<div class="col-second even-row-color"><code><a href="#guards()" class="member-name-link">guards</a></code></div>
<div class="col-last even-row-color">
<div class="block">
Declares <code>boolean</code> expressions that define whether or not input values are
applicable to this specialization instance.</div>
</div>
<div class="col-first odd-row-color"><code><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color"><code><a href="#insertBefore()" class="member-name-link">insertBefore</a></code></div>
<div class="col-last odd-row-color">
<div class="block">References a specialization of a super class by its method name where this specialization is
inserted before.</div>
</div>
<div class="col-first even-row-color"><code><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second even-row-color"><code><a href="#limit()" class="member-name-link">limit</a></code></div>
<div class="col-last even-row-color">
<div class="block">
Declares the expression that limits the number of specialization instantiations.</div>
</div>
<div class="col-first odd-row-color"><code><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</code></div>
<div class="col-second odd-row-color"><code><a href="#replaces()" class="member-name-link">replaces</a></code></div>
<div class="col-last odd-row-color">
<div class="block">
Declares other specializations of the same operation to be replaced by this specialization.</div>
</div>
<div class="col-first even-row-color"><code><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;? extends <a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/Throwable.html" title="class or interface in java.lang" class="external-link">Throwable</a>&gt;[]</code></div>
<div class="col-second even-row-color"><code><a href="#rewriteOn()" class="member-name-link">rewriteOn</a></code></div>
<div class="col-last even-row-color">
<div class="block">Declares an event guards that trigger re-specialization in case an exception is thrown in the
specialization body.</div>
</div>
<div class="col-first odd-row-color"><code>int</code></div>
<div class="col-second odd-row-color"><code><a href="#unroll()" class="member-name-link">unroll</a></code></div>
<div class="col-last odd-row-color">
<div class="block">Instructs the specialization to unroll a specialization with multiple instances.</div>
</div>
</div>
</section>
</li>
</ul>
</section>
<section class="details" id="annotation-interface-element-detail">
<ul class="details-list">
<!-- ============ ANNOTATION INTERFACE MEMBER DETAIL =========== -->
<li>
<section class="member-details">
<h2>Element Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="insertBefore()">
<h3>insertBefore</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">insertBefore</span></div>
<div class="block">References a specialization of a super class by its method name where this specialization is
inserted before. The declaration order of a specialization is not usable for nodes where
specializations are partly declared in the super class and partly declared in a derived
class. By default all specializations declared in the derived class are appended to those in
the super class. This attribute can be used to override the default behavior.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.8 or earlier</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>""</code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="rewriteOn()">
<h3>rewriteOn</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/Class.html" title="class or interface in java.lang" class="external-link">Class</a>&lt;? extends <a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/Throwable.html" title="class or interface in java.lang" class="external-link">Throwable</a>&gt;[]</span>&nbsp;<span class="element-name">rewriteOn</span></div>
<div class="block">Declares an event guards that trigger re-specialization in case an exception is thrown in the
specialization body. This attribute can be used to declare a list of such exceptions. Guards
of this kind are useful to avoid calculating a value twice when it is used in the guard and
its specialization.
<p>
If an event guard exception is triggered then all instantiations of this specialization are
removed. If one of theses exceptions is thrown once then no further instantiations of this
specialization are going to be created for this node.

<p>
<b>Example usage:</b>

<pre>
&#064;Specialization(rewriteOn = ArithmeticException.class)
int doAddNoOverflow(int a, int b) {
    return Math.addExact(a, b);
}
&#064;Specialization
long doAddWithOverflow(int a, int b) {
    return a + b;
}
...
Example executions:
  execute(Integer.MAX_VALUE - 1, 1) =&gt; doAddNoOverflow(Integer.MAX_VALUE - 1, 1)
  execute(Integer.MAX_VALUE, 1)     =&gt; doAddNoOverflow(Integer.MAX_VALUE, 1)
                                    =&gt; throws ArithmeticException
                                    =&gt; doAddWithOverflow(Integer.MAX_VALUE, 1)
  execute(Integer.MAX_VALUE - 1, 1) =&gt; doAddWithOverflow(Integer.MAX_VALUE - 1, 1)
</pre>

In case of explicitly declared <a href="../nodes/UnexpectedResultException.html" title="class in com.oracle.truffle.api.nodes"><code>UnexpectedResultException</code></a>s, the result from the
exception will be used. For all other exception types, the next available specialization will
be executed, so that the original specialization must ensure that no non-repeatable
side-effect is caused until the rewrite is triggered.
<p>
If a specialization declares an <a href="../nodes/UnexpectedResultException.html" title="class in com.oracle.truffle.api.nodes"><code>UnexpectedResultException</code></a> which is
<a href="#replaces()"><code>replaced</code></a> by another specialization with the same signature
and state, but without declared <a href="../nodes/UnexpectedResultException.html" title="class in com.oracle.truffle.api.nodes"><code>UnexpectedResultException</code></a> then the specialization is
used as so-called boxing overload of the replacing specialization. Boxing overloads share the
same state and must be implemented in a way such that they perform exactly the same
operation, with the exception of the unexpected result. Boxing overloads are used as direct
replacements when code for boxing elimination is generated. They are only used if an execute
method with the return type of the boxing overload and an <a href="../nodes/UnexpectedResultException.html" title="class in com.oracle.truffle.api.nodes"><code>UnexpectedResultException</code></a>
is declared in the node, or alternatively in the Bytecode DSL if the return type is
configured to be boxing eliminated. Boxing overloads share the state with its replacing
specialization, which makes them particularly useful to implement read nodes with boxing
elimination.
<p>
<b>Usage for boxing elimination:</b>

<pre>
&#64;Specialization(guards = "arg == cachedArg", limit = "2",
                    rewriteOn = UnexpectedResultException.class)
int doInt(Object arg, &#64;Cached("arg") Object cachedArg)
                                                 throws UnexpectedResultException {
    if (cachedArg instanceof Integer i) {
        return 42;
    }
    throw new UnexpectedResultException(cachedArg);
}

&#64;Specialization(guards = "arg == cachedArg", limit = "2", replaces = "doInt")
Object doGeneric(Object arg, &#64;Cached("arg") Object cachedArg) {
    return cachedArg;
}

...
Example executions:
  execute(42) =&gt; doGeneric(42, 42)
  executeInt(43) =&gt; doInt(43, 43)
  executeInt(42) =&gt; doInt(42, 42)
  // shared inline cache limit of 2 reached
  execute(44) =&gt; <a href="UnsupportedSpecializationException.html" title="class in com.oracle.truffle.api.dsl"><code>UnsupportedSpecializationException</code></a>
</pre></div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.8 or earlier</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/Math.html#addExact(int,int)" title="class or interface in java.lang" class="external-link"><code>Math.addExact(int, int)</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>{}</code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="replaces()">
<h3>replaces</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</span>&nbsp;<span class="element-name">replaces</span></div>
<div class="block"><p>
Declares other specializations of the same operation to be replaced by this specialization.
Other specializations are referenced using their unique method name. If this specialization
is instantiated then all replaced specialization instances are removed and never instantiated
again for this node instance. Therefore this specialization should handle strictly more
inputs than which were handled by the replaced specialization, otherwise the removal of the
replaced specialization will lead to unspecialized types of input values. The replaces
declaration is transitive for multiple involved specializations.
</p>
<b>Example usage:</b>

<pre>
&#064;Specialization(guards = "b == 2")
void doDivPowerTwo(int a, int b) {
    return a &gt;&gt; 1;
}
&#064;Specialization(replaces ="doDivPowerTwo", guards = "b &gt; 0")
void doDivPositive(int a, int b) {
    return a / b;
}
...
Example executions with replaces="doDivPowerTwo":
  execute(4, 2) =&gt; doDivPowerTwo(4, 2)
  execute(9, 3) =&gt; doDivPositive(9, 3) // doDivPowerTwo instances get removed
  execute(4, 2) =&gt; doDivPositive(4, 2)
Same executions without replaces="doDivPowerTwo"
  execute(4, 2) =&gt; doDivPowerTwo(4, 2)
  execute(9, 3) =&gt; doDivPositive(9, 3)
  execute(4, 2) =&gt; doDivPowerTwo(4, 2)
</pre>

</p></div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.22</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="#guards()"><code>guards()</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>{}</code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="guards()">
<h3>guards</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</span>&nbsp;<span class="element-name">guards</span></div>
<div class="block"><p>
Declares <code>boolean</code> expressions that define whether or not input values are
applicable to this specialization instance. Guard expressions must always return the same
result for each combination of the enclosing node instance and the bound input values.
</p>
<p>
If a guard expression does not bind any dynamic input parameters then the DSL, by default,
assumes that the result will not change for this node after specialization instantiation. In
other words the DSL assumes idempotence for this guard on the fast-path, by default. The
<a href="Idempotent.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Idempotent</code></a> and <a href="NonIdempotent.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>NonIdempotent</code></a> annotations may be used to configure this
explicitly. The DSL will also emit warnings in case the use of such annotations is
recommended. If assertions are enabled (-ea), then the DSL will assert that the idempotence
property does hold at runtime.
</p>
<p>
Guard expressions are defined using a subset of Java. This subset includes field/parameter
accesses, function calls, type exact infix comparisons (==, !=, &lt;, &lt;=, &gt;, &gt;=),
logical negation (!), logical disjunction (||), null, true, false, and integer literals. The
return type of guard expressions must be <code>boolean</code>. Bound elements without
receivers are resolved using the following order:
<ol>
<li>Dynamic and cached parameters of the enclosing specialization.</li>
<li>Fields defined using <a href="NodeField.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>NodeField</code></a> for the enclosing node.</li>
<li>Non-private, static or virtual methods or fields of enclosing node.</li>
<li>Non-private, static or virtual methods or fields of super types of the enclosing node.
</li>
<li>Public and static methods or fields imported using <a href="ImportStatic.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a>.</li>
</ol>
</p>
<p>
<b>Example usage:</b>

<pre>
static boolean acceptOperand(int operand) {
    assert operand &lt;= 42;
    return (operand &amp; 1) == 1;
}

&#64;Specialization(guards = {"operand &lt;= 42", "acceptOperand(operand)"})
void doSpecialization(int operand) {...}
</pre>

</p></div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.8 or earlier</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="Cached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Cached</code></a></li>
<li><a href="ImportStatic.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>{}</code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="assumptions()">
<h3>assumptions</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>[]</span>&nbsp;<span class="element-name">assumptions</span></div>
<div class="block"><p>
Declares assumption guards that optimistically assume that the state of an <a href="../Assumption.html" title="interface in com.oracle.truffle.api"><code>Assumption</code></a>
remains valid. Assumption expressions are cached once per specialization instantiation. If
one of the returned assumptions gets invalidated then the specialization instance is removed.
If the assumption expression returns an array of assumptions then all assumptions of the
array are checked. This is limited to one-dimensional arrays.
</p>
<p>
Assumption expressions are defined using a subset of Java. This subset includes
field/parameter accesses, function calls, type exact infix comparisons (==, !=, &lt;, &lt;=,
&gt;, &gt;=), logical negation (!), logical disjunction (||), null, true, false, and integer
literals. The return type of the expression must be <a href="../Assumption.html" title="interface in com.oracle.truffle.api"><code>Assumption</code></a> or an array of
<a href="../Assumption.html" title="interface in com.oracle.truffle.api"><code>Assumption</code></a> instances. Assumption expressions are not allowed to bind to dynamic
parameter values of the specialization. Bound elements without receivers are resolved using
the following order:
<ol>
<li>Cached parameters of the enclosing specialization.</li>
<li>Fields defined using <a href="NodeField.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>NodeField</code></a> for the enclosing node.</li>
<li>Non-private, static or virtual methods or fields of enclosing node.</li>
<li>Non-private, static or virtual methods or fields of super types of the enclosing node.
</li>
<li>Public and static methods or fields imported using <a href="ImportStatic.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a>.</li>
</ol>
</p>

<p>
<b>Example usage:</b>

<pre>
abstract static class DynamicObject() { abstract Shape getShape(); ... }
abstract static class Shape() { abstract Assumption getUnmodifiedAssuption(); ... }

&#64;Specialization(guards = "operand.getShape() == cachedShape", assumptions = "cachedShape.getUnmodifiedAssumption()")
void doAssumeUnmodifiedShape(DynamicObject operand, @Cached("operand.getShape()") Shape cachedShape) {...}
</pre>

</p></div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.8 or earlier</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="Cached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Cached</code></a></li>
<li><a href="ImportStatic.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>{}</code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="limit()">
<h3>limit</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type"><a href="https://docs.oracle.com/en/java/javase/25/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">limit</span></div>
<div class="block"><p>
Declares the expression that limits the number of specialization instantiations. The default
limit for specialization instantiations is defined as <code>"3"</code>. If the limit is
exceeded no more instantiations of the enclosing specialization method are created. Please
note that the existing specialization instantiations are <b>not</b> removed from the
specialization chain. You can use <a href="#replaces()"><code>replaces()</code></a> to remove unnecessary specializations
instances.
</p>
<p>
The limit expression is defined using a subset of Java. This subset includes field/parameter
accesses, function calls, type exact infix comparisons (==, !=, &lt;, &lt;=, &gt;, &gt;=),
logical negation (!), logical disjunction (||), null, true, false, and integer literals. The
return type of the limit expression must be <code>int</code>. Limit expressions are not
allowed to bind to dynamic parameter values of the specialization. Bound elements without
receivers are resolved using the following order:
<ol>
<li>Cached parameters of the enclosing specialization.</li>
<li>Fields defined using <a href="NodeField.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>NodeField</code></a> for the enclosing node.</li>
<li>Non-private, static or virtual methods or fields of enclosing node.</li>
<li>Non-private, static or virtual methods or fields of super types of the enclosing node.
</li>
<li>Public and static methods or fields imported using <a href="ImportStatic.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a>.</li>
</ol>
</p>

<p>
<b>Example usage:</b>

<pre>
static int getCacheLimit() {
    return Integer.parseInt(System.getProperty("language.cacheLimit"));
}

&#64;Specialization(guards = "operand == cachedOperand", limit = "getCacheLimit()")
void doCached(Object operand, @Cached("operand") Object cachedOperand) {...}
</pre>

</p></div>
<dl class="notes">
<dt>Since:</dt>
<dd>0.8 or earlier</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="#guards()"><code>guards()</code></a></li>
<li><a href="#replaces()"><code>replaces()</code></a></li>
<li><a href="Cached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>Cached</code></a></li>
<li><a href="ImportStatic.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>ImportStatic</code></a></li>
</ul>
</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>""</code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="unroll()">
<h3>unroll</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type">int</span>&nbsp;<span class="element-name">unroll</span></div>
<div class="block">Instructs the specialization to unroll a specialization with multiple instances. Unrolling
causes fields of the inline cache to be directly stored in the node instead of a chained
inline cache. At most 8 instances of a specialization can be unrolled to avoid code explosion
in the interpreter.
<p>
A common use-case for this feature is to unroll the first instance of an inline cache. It is
often the case that specializations with multiple instances are instantiated only once. By
unrolling the first instance we can optimize for this common situation which may lead to
footprint and interpreter performance improvements.
<p>
This feature is prone to cause inefficiencies if used too aggressively. Extra care should be
taken, e.g. the generated code should be inspected and profiled to verify that the new code
is better than the previous version.
<p>
Consider the following example:

<pre>
class MyNode extends Node {

    static int limit = 2;

    abstract int execute(int value);

    &#64;Specialization(guards = "value == cachedValue", limit = "limit", unroll = 1)
    int doDefault(int value,
                    &#64;Cached("value") int cachedValue) {
        return value;
    }

}
</pre>

In this example we unroll the first instance of an inline cache on <code>int</code> values.
This is equivalent to manually specifying the following specializations:

<pre>
class MyUnrollNode extends Node {

    static int limit = 2;

    abstract int execute(int value);

    &#64;Specialization(guards = "value == cachedValue", limit = "1")
    int doUnrolled0(int value,
                    &#64;Cached("value") int cachedValue) {
        return value;
    }

    &#64;Specialization(guards = "value == cachedValue", limit = "limit - 1")
    int doDefault(int value,
                    &#64;Cached("value") int cachedValue) {
        return value;
    }
}

</pre></div>
<dl class="notes">
<dt>Since:</dt>
<dd>23.0</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>0</code></dd>
</dl>
</div>
</section>
</li>
<li>
<section class="detail" id="excludeForUncached()">
<h3>excludeForUncached</h3>
<div class="horizontal-scroll">
<div class="member-signature"><span class="return-type">boolean</span>&nbsp;<span class="element-name">excludeForUncached</span></div>
<div class="block">Excludes this specialization from use with <a href="GenerateUncached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>GenerateUncached</code></a>.
<p>
By default every specialization is included for <a href="GenerateUncached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>GenerateUncached</code></a>, except
specializations that require a <a href="#limit()"><code>limit</code></a> and are <a href="#replaces()"><code>replaced</code></a>,
those are excluded by default. By setting <a href="#excludeForUncached()"><code>excludeForUncached()</code></a>
explicitly the default behavior can be overridden, e.g. to include or exclude a
specialization for <a href="GenerateUncached.html" title="annotation interface in com.oracle.truffle.api.dsl"><code>GenerateUncached</code></a>.
<p>
Mark a specialization as excluded only when it is <a href="#replaces()"><code>replaced</code></a> by a more
generic one; otherwise cached and uncached nodes may diverge semantically. Any specialization
may be excluded from uncached. It is considered an error if all specializations are excluded
from uncached.</div>
<dl class="notes">
<dt>Since:</dt>
<dd>25.0</dd>
</dl>
<dl class="notes">
<dt>Default:</dt>
<dd><code>false</code></dd>
</dl>
</div>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<hr>
<p class="legal-copy"><small><center>Copyright &copy; 2012, 2025, Oracle and/or its affiliates. All rights reserved.</center></small></p>
</footer>
</main>
</div>
</body>
</html>
